<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
<div id="badge">
  
  <section class="all">

    <div class="list">
      <div class="mask"></div>
 
      <section>
        <div class="comments">
        <table>

		<tr th:each="comment:${commentList}" class="commentRow" onload="sessionCheck()">
			<td th:id="${comment.commentNo}" class="commentNo">
		  <img class="memberProfileImg" th:src="${comment.memberNo.profileImageNo.path}" />
			</td>
			
			<td th:id ="${comment.memberNo.nickname}" class="targetMemName">
			<span th:text="${comment.memberNo.nickname}"></span>
			<span  id="commentContents" th:text="${comment.contents}"></span>
			</td>
			
			<td th:id="${session.nickname}" class="commentDeleteBtn" >
			<span><a th:href="@{/deleteComment(commentNo=${comment.commentNo})}"/>   &times;</span>

			</td>
		</tr>  
		</table>
		
		<!-- 紐⑤떖 -->
		<form id="reportModal" class="modal" method=post>
			<div class="modalContents">
				<h1>�떊怨좏븯湲�</h1>
				<br>
				<span class="close">&times;</span>
				<input id = "reportType" name="reportType" th:value="1" hidden="true"/>
				<input id = "targetCommentNo" hidden="true"/>
				<input id = "targetMemName" hidden="true"/>
				<button class="reportBtn" id="reportBtn1" name="reportBtn1">�쑀�빐�븳 �궡�슜</button>
				<button class="reportBtn" id="reportBtn2" name="reportBtn2">愿묎퀬�꽦 �궡�슜</button>
			</div>
			
			<script>
<!-- 紐⑤떖 �븿�닔�뱾  -->
$(".commentRow").click( function() {
	console.log($(this).children('td.commentNo').attr('id'));
	$(reportModal).show();
	
	targetCommentNo = $(this).children('td.commentNo').attr('id');
	console.log("��寃잙꽆踰�: " + targetCommentNo);
	$("#targetCommentNo").val(targetCommentNo);
	
	targetMemName = $(this).children('td.targetMemName').attr('id');
	console.log("�씪�씠�꽣紐�: " + targetMemName);
	$("#targetMemName").val(targetMemName);
	
});

$(".close").click(function(event) {
	$(reportModal).hide();
});

$("#reportBtn1").on("click", function(){
	$(".reportBtn").val("�쑀�빐�븳 �궡�슜")
	});
	
$("#reportBtn2").on("click", function(){
	$(".reportBtn").val("愿묎퀬�꽦 �궡�슜")
});

$(".reportBtn").on("click", function(){
	var targetCommentNo = $("#targetCommentNo").val();
	var type='1';
	var reason = $(".reportBtn").val();

	
	$.ajax({
		type: 'post',
		url: '/insertReport',
		data : {
			"targetCommentNo" : targetCommentNo,
			"type" : type,
			"reason" : reason
			
		},
		
		success : function(result) {
			if(result == 'SUCCESS'){
				console.log("�떊怨� �셿猷�");
				
			}
		}
	
	});
	alert("�떊怨좉� �젒�닔�릺�뿀�뒿�땲�떎");
	/* $(resultModal).show(); */
});

</script>
		
		</form>
		
		<form id="resultModal" class="modal" method=post>
			<div class="modalContents">
			<span class="close">&times;</span>
				<h1>�떊怨� �젒�닔 �셿猷�!</h1>
				<p>�떊怨좊릺�뿀�뒿�땲�떎
				怨� �젒�닔 �삁�젙�엯�땲�떎</p>
				<br>
				<p id="close">�솗�씤</p>
				
				
			</div>
		</form>
        </div> 
      </section> 
    </div>
  </section>
  
  <section>
        <div class="commentInput">
        <form name=commentInputForm action="/insertComment" method="post">
			<td><input type="text" name="contents" id="contents" placeholder="�궡�슜�쓣 �엯�젰�빐二쇱꽭�슂" ></td>
			<td><button type="submit" id="insertBtn" onchange="InputProcess()">�벑濡�</button></td>
		</form>
        </div>
  </section>
  
</div>



<script type="text/javascript" th:inline="javascript">
	document.getElementById("insertBtn").disabled = true;
	document.onkeyup = InputProcess;
	document.onmouseup = InputProcess;
	document.onmousedown = InputProcess;

	function InputProcess(){
		
		/*<![CDATA[*/
		if (document.getElementById("contents").value == ''){
			document.getElementById("insertBtn").disabled = true;
		} else {
			document.getElementById("insertBtn").disabled = false;
		}
		/*]]>*/
	};
	
	$(".commentRow").each(function sessionCheck(){
		var sessionNickName = $(this).children(".commentDeleteBtnRow").attr("id");
		var commentWriter = $(this).children(".commentDeleteBtnRow").children(".commentDeleteBtn").attr("id");
		var elems = document.getElementById(sessionNickName);

		
		console.log(sessionNickName +","+ commentWriter);
		
		/*<![CDATA[*/
		if( sessionNickName == commentWriter ){
			console.log("�씪移섑븿!")
			$(this).children(".commentDeleteBtnRow").css('display','block');
			} 
		/*]]>*/
	});
	
	
</script>	
</body>
</html>